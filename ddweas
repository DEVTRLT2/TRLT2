-- [[ BAGIAN LOGIKA DI DALAM AmbilTree / ChopTree ]] --

local toolNameVal = tool:FindFirstChild("ToolName") and tool.ToolName.Value or tool.Name
local axeStats = moduleAxe[toolNameVal]

-- Inisialisasi dengan nilai default dari database
local finalDamage = axeStats.Damage or 1
local finalCooldown = axeStats.SwingCooldown or 0.5

-- [[ PENGECEKAN SPECIAL TREES UNTUK DAMAGE & COOLDOWN ]] --
if axeStats.SpecialTrees and axeStats.SpecialTrees[targetClass] then
    -- Jika di dalam SpecialTrees nilainya berupa angka (Damage), kita pakai itu
    if type(axeStats.SpecialTrees[targetClass]) == "number" then
        finalDamage = axeStats.SpecialTrees[targetClass]
    end
    
    -- Cek juga apakah ada spesifikasi Cooldown khusus di dalam SpecialTrees
    -- Beberapa database script LT2 menyimpan table di dalam SpecialTrees
    if type(axeStats.SpecialTrees[targetClass]) == "table" then
        finalDamage = axeStats.SpecialTrees[targetClass].Damage or finalDamage
        finalCooldown = axeStats.SpecialTrees[targetClass].SwingCooldown or finalCooldown
    else
        -- Jika SpecialTrees hanya berisi angka damage, biasanya cooldown dibuat sangat kecil
        -- agar penebangan terasa instan (Insta-Chop)
        finalCooldown = 0.01 
    end
    
    print("MODES SPECIAL: Damage ("..tostring(finalDamage)..") Cooldown ("..tostring(finalCooldown)..")")
end

-- [[ EKSEKUSI LOOP PENEBANGAN ]] --
local isChopping = true
task.spawn(function()
    while isChopping and targetTree and not targetTree:FindFirstChild("RootCut") do
        local cutEvent = targetTree:FindFirstChild("CutEvent")
        if cutEvent then
            RemoteProxy:FireServer(cutEvent, {
                ['tool'] = tool,
                ['faceVector'] = Vector3.new(1, 0, 0),
                ['height'] = 0.3,
                ['sectionId'] = 1,
                ['hitPoints'] = finalDamage, -- Menggunakan damage spesial
                ['cooldown'] = finalCooldown, -- Menggunakan cooldown spesial
                ['cuttingClass'] = 'Axe'
            })
        end
        -- Tunggu sesuai cooldown hasil kalkulasi di atas
        task.wait(finalCooldown + 0.01) 
    end
end)
